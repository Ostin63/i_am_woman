let searchTxt,clonedTxt,clonedLbl,clonedLblWrap,search=document.querySelector(".search"),searchInp=search.children[0],searchLbl=search.children[1],searchBtn=search.children[2],searchBrd=search.children[3],searchCls=search.children[4],animating=!1,busy=!0,TLTxt=new TimelineLite,TLSrch=new TimelineLite({onReverseComplete:()=>{TLTxt.clear(),animating=!1}});function createTxt(e,t,a){let r=[];for(let t=e.length;t--;)r.unshift(`<span class='${a}'>${e[t]}</span>`);t.innerHTML=r.join("")}function createLblTxt(e){createTxt(e,clonedLbl,"cloned-text"),clonedTxt=document.querySelectorAll(".cloned-text"),animClonedTxt(Array.from(clonedTxt).reverse())}function animSearch(){animating=!0,TLSrch.restart().to(searchBrd,.4,{scaleX:2,x:-25,y:0,ease:Sine.easeIn}).to(searchBtn,.4,{rotationX:90,ease:Sine.easeIn},"-=.4").to(searchBrd,.4,{rotation:180,x:"-=6",y:"+=10",ease:Power2.easeInOut}).set(searchBrd,{transformOrigin:"0",marginRight:"-58px"}).to(searchBrd,.6,{scaleX:63,ease:Power1.easeOut}).set(search,{className:"+=edge",onComplete:showTxt}).to(searchInp,.6,{scaleX:1,ease:Sine.easeInOut},"-=.3").set(searchCls,{className:"+=visible"}).addPause()}function showTxt(){new TimelineLite({onStart:()=>{searchInp.disabled=!0}}).staggerTo(searchTxt,.07,{opacity:1},.035),setTimeout(()=>{searchInp.disabled=!1,busy=!1},300)}function animClonedTxt(e){let t=clonedLbl.scrollWidth,a=t-clonedLbl.offsetWidth,r=new TimelineLite({onComplete:()=>{clonedLblWrap.remove()}});r.staggerTo(e,.08,{opacity:0},.04);let n=r.totalDuration(),c=a*n/t;a>0&&TweenLite.fromTo(clonedLbl,c,{x:-a},{x:0,delay:.2,ease:SlowMo.ease.config(.1,.1,!1)}),setTimeout(()=>{TLSrch.reverse()},Math.max(1e3*(n-.35),0))}function cloneLbl(){clonedLblWrap=document.createElement("div"),clonedLblWrap.className="search-label",search.appendChild(clonedLblWrap),clonedLbl=document.createElement("div"),clonedLblWrap.appendChild(clonedLbl)}createTxt("Введите текст",searchLbl,"search-text"),searchTxt=document.querySelectorAll(".search-text"),searchBtn.addEventListener("click",()=>{animating||animSearch()}),searchBrd.addEventListener("click",()=>{animating||animSearch()}),searchInp.addEventListener("focus",()=>{busy||searchInp.value.trim().length||(TLTxt.isActive()?TLTxt.play():TLTxt.restart().timeScale(1).staggerTo(searchTxt,.07,{opacity:0},.035))}),searchInp.addEventListener("blur",()=>{busy||searchInp.value.trim().length||TLTxt.reverse().timeScale(1.3)}),search.addEventListener("submit",e=>{e.preventDefault(),busy=!0,TLTxt.paused()?TLTxt.clear():TLTxt.play();let t=searchInp.value.trim();searchInp.disabled=!0,t.length?(cloneLbl(),createLblTxt(t)):TLSrch.reverse(),searchInp.value="",searchInp.blur()}),searchCls.addEventListener("mousedown",e=>{e.preventDefault()}),searchCls.addEventListener("click",()=>{if(busy)return;busy=!0;let e=searchInp.value.trim();searchInp.disabled=!0,e.length?(cloneLbl(),createLblTxt(e)):(TLTxt.isActive()?TLTxt.play():1==TLTxt.progress()?TLTxt.clear():TLTxt.restart().timeScale(1).staggerTo(searchTxt,.07,{opacity:0},.035),TLSrch.reverse()),searchInp.value="",searchInp.blur()});